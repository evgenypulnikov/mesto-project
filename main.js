(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_is_opened"),document.addEventListener("keydown",o)}function n(e){e.classList.remove("popup_is_opened"),document.removeEventListener("keydown",o)}function o(e){"Escape"===e.key&&n(document.querySelector(".popup_is_opened"))}e.d({},{Fc:()=>$,Lu:()=>M,R$:()=>G,sw:()=>R});var r=document.querySelectorAll(".popup"),c=document.querySelector(".profile__avatar-change-button"),i=document.querySelector(".popup_avatar-change"),a=document.forms.avatarChangeForm,u=a.elements.avatarUrl,s=a.querySelector(".form__submit"),l=document.querySelector(".profile__edit-button"),d=document.querySelector(".popup_edit-profile"),f=document.querySelector(".profile__picture"),m=document.querySelector(".profile__name"),_=document.querySelector(".profile__status"),p=document.forms.editProfileForm,h=p.elements.profileName,v=p.elements.profileStatus,y=p.querySelector(".form__submit"),b=document.querySelector(".profile__add-button"),S=document.querySelector(".popup_add-place"),g=document.forms.addPlaceForm,L=g.elements.placeTitle,q=g.elements.placeUrl,E=g.querySelector(".form__submit"),k=document.querySelector("#grid-post").content,C=k.querySelector(".photo-grid__image"),U=k.querySelector(".photo-grid__item-title"),x=document.querySelector(".photo-grid__list"),A=document.querySelector(".popup_image-full"),P=A.querySelector(".full-view__image"),w=A.querySelector(".full-view__caption");function T(e,n){C.src=e.link,C.alt=e.name,C.id=e.id,U.textContent=e.name;var o=k.cloneNode(!0),r=o.querySelector(".photo-grid__likes-counter"),c=o.querySelector(".photo-grid__like-button");if(c.addEventListener("click",(function(t){t.target.classList.contains("photo-grid__like-button_is_active")?(t.target.classList.remove("photo-grid__like-button_is_active"),R(e,r)):(t.target.classList.add("photo-grid__like-button_is_active"),M(e,r))})),r.textContent=e.likes.length,$(e,n,c),e.owner._id===n){var i=o.querySelector(".photo-grid__delete-button");i.style.display="block",i.addEventListener("click",(function(t){t.target.closest(".photo-grid__item").remove(),G(e)}))}return o.querySelector(".photo-grid__image").addEventListener("click",(function(n){P.src=e.link,P.alt=e.name,w.textContent=e.name,t(A)})),o}var O={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_is_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_is_active"};function D(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",""))}function B(e){e.classList.add("form__submit_is_disabled"),e.setAttribute("disabled","")}var N,j,F={baseUrl:"https://nomoreparties.co/v1/plus-cohort-11",headers:{authorization:"a27e57c8-83b5-46fa-9811-ed86f5708328","Content-Type":"application/json"}};function J(e){if(e.ok)return e.json()}function H(e,t,n){t.textContent=e?"Сохранение...":n}function z(e,t){m.textContent=e,_.textContent=t}function M(e,t){var n;(n=e._id,fetch("".concat(F.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:F.headers}).then((function(e){return J(e)}))).then((function(e){t.textContent=e.likes.length})).catch((function(e){console.log(e)}))}function R(e,t){var n;(n=e._id,fetch("".concat(F.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:F.headers}).then((function(e){return J(e)}))).then((function(e){t.textContent=e.likes.length})).catch((function(e){console.log(e)}))}function $(e,t,n){fetch("".concat(F.baseUrl,"/cards"),{headers:F.headers}).then((function(e){return J(e)})).then((function(o){e.likes.forEach((function(e){e._id===t&&n.classList.add("photo-grid__like-button_is_active")}))})).catch((function(e){console.log(e)}))}function G(e){var t;(t=e._id,fetch("".concat(F.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:F.headers}).then((function(e){return J(e)}))).catch((function(e){console.log(e)}))}r.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_is_opened")&&n(e),t.target.classList.contains("popup__close-button")&&n(e)}))})),l.addEventListener("click",(function(){var e,n;e=m.textContent,n=_.textContent,h.value=e,v.value=n,t(d)})),p.addEventListener("submit",(function(e){var t,o;e.preventDefault(),H(!0,y),(t=h.value,o=v.value,fetch("".concat(F.baseUrl,"/users/me"),{method:"PATCH",headers:F.headers,body:JSON.stringify({name:t,about:o})}).then((function(e){return J(e)}))).then((function(){z(h.value,v.value),n(d)})).finally((function(){B(y),H(!1,y,"Сохранить")}))})),b.addEventListener("click",(function(){t(S)})),g.addEventListener("submit",(function(e){var t,o;e.preventDefault(),H(!0,E),(t=L.value,o=q.value,fetch("".concat(F.baseUrl,"/cards/"),{method:"POST",headers:F.headers,body:JSON.stringify({name:t,link:o})}).then((function(e){return J(e)}))).then((function(e){!function(e){var t;t=T(e,j),x.prepend(t)}(e),n(S),g.reset()})).catch((function(e){console.log(e)})).finally((function(){B(E),H(!1,E,"Создать")}))})),c.addEventListener("click",(function(){t(i)})),a.addEventListener("submit",(function(e){var t;e.preventDefault(),H(!0,s),(t=u.value,fetch("".concat(F.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:F.headers,body:JSON.stringify({avatar:t})}).then((function(e){return J(e)}))).then((function(e){f.src=e.avatar,n(i),a.reset()})).catch((function(e){console.log(e)})).finally((function(){B(s),H(!1,s,"Сохранить")}))})),N=O,Array.from(document.querySelectorAll(N.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(e.querySelectorAll(".form__fieldset")).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);D(n,o,O),n.forEach((function(t){t.addEventListener("input",(function(){!function(e,t){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,O):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,O)}(e,t),D(n,o,O)}))}))}(e,O)}))})),Promise.all([fetch("".concat(F.baseUrl,"/users/me"),{headers:F.headers}).then((function(e){return J(e)})),fetch("".concat(F.baseUrl,"/cards"),{headers:F.headers}).then((function(e){return J(e)}))]).then((function(e){j=e[0]._id,f.src=e[0].avatar,z(e[0].name,e[0].about),e[1].forEach((function(e){!function(e,t){t.append(e)}(T(e,j),x)}))})).catch((function(e){console.log(e)}))})();