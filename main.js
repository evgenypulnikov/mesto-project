(()=>{"use strict";function e(e){e.classList.add("popup_is_opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_is_opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is_opened"))}var o={baseUrl:"https://nomoreparties.co/v1/plus-cohort-11",headers:{authorization:"a27e57c8-83b5-46fa-9811-ed86f5708328","Content-Type":"application/json"}};function r(e){if(e.ok)return e.json()}var c,i=document.querySelectorAll(".popup"),a=document.querySelector(".profile__avatar-change-button"),s=document.querySelector(".popup_avatar-change"),u=document.forms.avatarChangeForm,l=u.elements.avatarUrl,d=u.querySelector(".form__submit"),f=document.querySelector(".profile__edit-button"),_=document.querySelector(".popup_edit-profile"),m=document.querySelector(".profile__picture"),h=document.querySelector(".profile__name"),p=document.querySelector(".profile__status"),v=document.forms.editProfileForm,y=v.elements.profileName,b=v.elements.profileStatus,g=v.querySelector(".form__submit"),S=document.querySelector(".profile__add-button"),q=document.querySelector(".popup_add-place"),L=document.forms.addPlaceForm,E=L.elements.placeTitle,C=L.elements.placeUrl,k=L.querySelector(".form__submit"),x=document.querySelector("#grid-post").content,U=x.querySelector(".photo-grid__image"),A=x.querySelector(".photo-grid__item-title"),T=document.querySelector(".photo-grid__list"),w=document.querySelector(".popup_image-full"),D=w.querySelector(".full-view__image"),P=w.querySelector(".full-view__caption");function B(t){U.src=t.link,U.alt=t.name,U.id=t.id,A.textContent=t.name;var n=x.cloneNode(!0),i=n.querySelector(".photo-grid__likes-counter"),a=n.querySelector(".photo-grid__like-button");if(a.addEventListener("click",(function(e){var n;e.target.classList.contains("photo-grid__like-button_is_active")?(e.target.classList.remove("photo-grid__like-button_is_active"),function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return r(e)}))}(t._id).then((function(e){i.textContent=e.likes.length})).catch((function(e){console.log(e)}))):(e.target.classList.add("photo-grid__like-button_is_active"),(n=t._id,fetch("".concat(o.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:o.headers}).then((function(e){return r(e)}))).then((function(e){i.textContent=e.likes.length})).catch((function(e){console.log(e)})))})),i.textContent=t.likes.length,fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then((function(e){return r(e)})).then((function(e){t.likes.forEach((function(e){e._id===c&&a.classList.add("photo-grid__like-button_is_active")}))})).catch((function(e){console.log(e)})),t.owner._id===c){var s=n.querySelector(".photo-grid__delete-button");s.style.display="block",s.addEventListener("click",(function(e){var n;e.target.closest(".photo-grid__item").remove(),(n=t._id,fetch("".concat(o.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:o.headers}).then((function(e){return r(e)}))).catch((function(e){console.log(e)}))}))}return n.querySelector(".photo-grid__image").addEventListener("click",(function(n){D.src=t.link,D.alt=t.name,P.textContent=t.name,e(w)})),n}fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then((function(e){return r(e)})).then((function(e){c=e._id})).catch((function(e){console.log(e)}));var N,O={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_is_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_is_active"};function F(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",""))}function J(e){e.classList.add("form__submit_is_disabled"),e.setAttribute("disabled","")}function j(e,t,n){t.textContent=e?"Сохранение...":n}function H(e,t){h.textContent=e,p.textContent=t}i.forEach((function(e){e.addEventListener("mousedown",(function(n){n.target.classList.contains("popup_is_opened")&&t(e),n.target.classList.contains("popup__close-button")&&t(e)}))})),f.addEventListener("click",(function(){var t,n;t=h.textContent,n=p.textContent,y.value=t,b.value=n,e(_)})),v.addEventListener("submit",(function(e){var n,c;e.preventDefault(),H(y.value,b.value),j(!0,g),(n=h.textContent,c=p.textContent,fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:n,about:c})}).then((function(e){return r(e)}))).then((function(){t(_)})).finally((function(){J(g),j(!1,g,"Сохранить")}))})),S.addEventListener("click",(function(){e(q)})),L.addEventListener("submit",(function(e){var n,c;e.preventDefault(),j(!0,k),(n=E.value,c=C.value,fetch("".concat(o.baseUrl,"/cards/"),{method:"POST",headers:o.headers,body:JSON.stringify({name:n,link:c})}).then((function(e){return r(e)}))).then((function(e){!function(e){var t;t=B(e),T.prepend(t)}(e),t(q)})).catch((function(e){console.log(e)})).finally((function(){J(k),j(!1,k,"Создать")})),L.reset()})),a.addEventListener("click",(function(){e(s)})),u.addEventListener("submit",(function(e){var n;e.preventDefault(),j(!0,d),(n=l.value,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:n})}).then((function(e){return r(e)}))).then((function(e){m.src=e.avatar,t(s)})).catch((function(e){console.log(e)})).finally((function(){J(d),j(!1,d,"Сохранить")})),u.reset()})),N=O,Array.from(document.querySelectorAll(N.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(e.querySelectorAll(".form__fieldset")).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);F(n,o,O),n.forEach((function(t){t.addEventListener("input",(function(){!function(e,t){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,O):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,O)}(e,t),F(n,o,O)}))}))}(e,O)}))})),fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then((function(e){return r(e)})).then((function(e){m.src=e.avatar,H(e.name,e.about)})).catch((function(e){console.log(e)})),fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then((function(e){return r(e)})).then((function(e){e.forEach((function(e){!function(e,t){t.append(e)}(B(e),T)}))})).catch((function(e){console.log(e)}))})();