(()=>{"use strict";function e(e){e.classList.add("popup_is_opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_is_opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is_opened"))}var o={baseUrl:"https://nomoreparties.co/v1/plus-cohort-11",headers:{authorization:"a27e57c8-83b5-46fa-9811-ed86f5708328","Content-Type":"application/json"}};function r(e){if(e.ok)return e.json()}var c=document.querySelectorAll(".popup"),i=document.querySelector(".profile__avatar-change-button"),a=document.querySelector(".popup_avatar-change"),s=document.forms.avatarChangeForm,u=s.elements.avatarUrl,l=s.querySelector(".form__submit"),d=document.querySelector(".profile__edit-button"),f=document.querySelector(".popup_edit-profile"),_=document.querySelector(".profile__picture"),m=document.querySelector(".profile__name"),p=document.querySelector(".profile__status"),h=document.forms.editProfileForm,v=h.elements.profileName,b=h.elements.profileStatus,y=h.querySelector(".form__submit"),S=document.querySelector(".profile__add-button"),g=document.querySelector(".popup_add-place"),L=document.forms.addPlaceForm,q=L.elements.placeTitle,E=L.elements.placeUrl,C=L.querySelector(".form__submit"),k=document.querySelector(".photo-grid__list"),x=document.querySelector(".popup_image-full"),A=x.querySelector(".full-view__image"),U=x.querySelector(".full-view__caption");function P(t,n,c,i,a,s){var u=document.querySelector("#grid-post").content,l=u.querySelector(".photo-grid__image"),d=u.querySelector(".photo-grid__item-title");l.src=t,l.alt=n,l.id=i,d.textContent=n;var f=u.cloneNode(!0),_=f.querySelector(".photo-grid__likes-counter"),m=f.querySelector(".photo-grid__like-button");if(m.addEventListener("click",(function(e){var t;e.target.classList.contains("photo-grid__like-button_is_active")?(e.target.classList.remove("photo-grid__like-button_is_active"),function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return r(e)}))}(i).then((function(e){return _.textContent=e.likes.length,Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))):(e.target.classList.add("photo-grid__like-button_is_active"),(t=i,fetch("".concat(o.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:o.headers}).then((function(e){return r(e)}))).then((function(e){return _.textContent=e.likes.length,Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})))})),_.textContent=a,fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then((function(e){return r(e)})).then((function(e){s.forEach((function(e){console.log(e._id),"34f8cd9478826799e75475a9"===e._id&&m.classList.add("photo-grid__like-button_is_active")}))})),"34f8cd9478826799e75475a9"===c){var p=f.querySelector(".photo-grid__delete-button");p.style.display="block",p.addEventListener("click",(function(e){var t;e.target.closest(".photo-grid__item").remove(),(t=i,fetch("".concat(o.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:o.headers}).then((function(e){return r(e)}))).then((function(e){return Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}))}return f.querySelector(".photo-grid__image").addEventListener("click",(function(o){A.src=t,A.alt=n,U.textContent=n,e(x)})),f}var j,T={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_is_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_is_active"};function w(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",""))}function N(e,t,n){t.textContent=e?"Сохранение...":n}c.forEach((function(e){e.addEventListener("mousedown",(function(n){n.target.classList.contains("popup_is_opened")&&t(e),n.target.classList.contains("popup__close-button")&&t(e)}))})),d.addEventListener("click",(function(){v.value=m.textContent,b.value=p.textContent,e(f)})),h.addEventListener("submit",(function(e){var n,c;e.preventDefault(),m.textContent=v.value,p.textContent=b.value,N(!0,y),(n=m.textContent,c=p.textContent,fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:n,about:c})}).then((function(e){return r(e)}))).finally((function(){y.classList.add("form__submit_is_disabled"),y.setAttribute("disabled",""),t(f),N(!1,y,"Сохранить")}))})),S.addEventListener("click",(function(){e(g)})),L.addEventListener("submit",(function(e){var n,c;e.preventDefault(),N(!0,C),(n=q.value,c=E.value,fetch("".concat(o.baseUrl,"/cards/"),{method:"POST",headers:o.headers,body:JSON.stringify({name:n,link:c})}).then((function(e){return r(e)}))).then((function(e){return function(e){var t;t=P(e.link,e.name,e.owner._id,e._id,e.likes.length,e.likes),k.prepend(t)}(e),Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).finally((function(){C.classList.add("form__submit_is_disabled"),C.setAttribute("disabled",""),t(g),N(!1,C,"Создать")})),L.reset()})),i.addEventListener("click",(function(){e(a)})),s.addEventListener("submit",(function(e){var n;e.preventDefault(),N(!0,l),(n=u.value,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:n})}).then((function(e){return r(e)}))).then((function(e){return _.src=e.avatar,Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).finally((function(){l.classList.add("form__submit_is_disabled"),l.setAttribute("disabled",""),t(a),N(!1,l,"Сохранить")})),s.reset()})),j=T,Array.from(document.querySelectorAll(j.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(e.querySelectorAll(".form__fieldset")).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);w(n,o,T),n.forEach((function(t){t.addEventListener("input",(function(){!function(e,t){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,T):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,T)}(e,t),w(n,o,T)}))}))}(e,T)}))})),fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then((function(e){return r(e)})).then((function(e){return _.src=e.avatar,m.textContent=e.name,p.textContent=e.about,Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})),fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then((function(e){return r(e)})).then((function(e){var t=JSON.stringify(e);JSON.parse(t).forEach((function(e){!function(e,t){t.append(e)}(P(e.link,e.name,e.owner._id,e._id,e.likes.length,e.likes),k)}))})).catch((function(e){console.log(e)}))})();